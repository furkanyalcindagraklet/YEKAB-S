{% extends 'base_layout.html' %}
{% block content %}


<!-- success modal -->
<div class="modal modal-success modal-success-food fade in" id="modal-success" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span></button>
                <h4 class="modal-title">İşlem Başarılı</h4>
            </div>
            <div class="modal-body successModal">
                ...
            </div>
            <div class="modal-footer">

                <button type="button" class="btn btn-outline btn-ok">Tamam</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<div class="modal modal-danger fade in deneme22" tabindex="-1" role="dialog" id="modal-danger"
     aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span></button>
                <h4 class="modal-title">Uyarı</h4>
            </div>
            <div class="modal-body">
                <p>Silmek istediğinizden emin misiniz?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline pull-left btn-ok" id="btn-conf"
                        data-dismiss="modal">Evet
                </button>
                <button type="button" class="btn btn-outline" id="btn-close">Hayır</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>



{% if messages %}
    {% for message in messages %}


        {% if message.tags == 'warning' %}

            <div class="alert alert-danger alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h4><i class="icon fa fa-ban"></i> Hata!</h4>


                <ul class="messages">
                    {% for message in messages %}
                        <li class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                </ul>


            </div>

        {% endif %}


        {% if message.tags == 'success' %}

            <div class="alert alert-success alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h4><i class="icon fa fa-check"></i> Başarılı!</h4>


                <ul class="messages">
                    {% for message in messages %}
                        <li class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                </ul>


            </div>

        {% endif %}
    {% endfor %}


{% endif %}




<section class="content">
    <section class="content-header">
        <div class="row">
            <div class="col-sm-6">
                <h3>İş Blogu Güncelle </h3>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    {% for p in perm %}
                        {% if p == 'add_businessBlog' %}
                            <li class="breadcrumb-item">


                                <a href="{% url "ekabis:add_businessBlog" %}"
                                   type="button" class="btn btn-success"><i
                                        class="fa fa-file"></i> İş Blogu Ekle
                                </a>

                            </li>
                        {% endif %}
                    {% endfor %}

                    {#                        <li class="breadcrumb-item">#}
                    {#                            <button id="birimdelete"#}
                    {#                                    type="button" class="btn btn-danger"><i#}
                    {#                                    class="fa fa-trash"></i> İş Blogu Sil#}
                    {#                            </button>#}
                    {#                        </li>#}


                </ol>
            </div>
        </div>
    </section>


    <form method="post" role="form">
        {% csrf_token %}

        <div class="row">
            <div class="col-lg-3">
                <div class="card card-primary">

                    <div class="card-body">
                        <div class="col-lg-12">


                            {% for item in business_form %}
                                <div class="form-group">
                                    <label>{{ item.label }}</label><br>

                                    {{ item }}
                                    <label for="" id="label_{{ item.name }}"></label>
                                </div>
                            {% endfor %}


                            <div class="card-footer">
                                <button type="submit" class="btn btn-primary">Kaydet</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="card card-primary card-outline">
                    <div class="card-header with-border">
                        <h3 class="card-title">Parametreler</h3>
                    </div>
                    {% for p in perm %}
                        {% if p == 'change_businessBlogParametre' %}
                            <div class="card-header with-border">
                                <div class="btn-group">
                                    <a href="{% url "ekabis:add_businessBlogParametre" business.uuid %}"
                                       type="button" class="btn btn-success"><i
                                            class="fa fa-edit"></i> Parametre Ekle
                                    </a>
                                </div>

                            </div>
                        {% endif %}
                    {% endfor %}
                    <div class="card-body">
                        <table id="kategori" class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th>No</th>
                                <th>Tanımı</th>
                                <th>Tipi</th>
                                <th>İnceleme/Silme</th>
                            </tr>
                            </thead>
                            <tbody>


                            {% if parametre %}
                                {% for category in parametre %}
                                    <tr>
                                        <td>{{ forloop.counter }} </td>
                                        <td>{{ category.title }}</td>
                                        <td>{% if category.type == "string" %}
                                            Metin
                                        {% elif category.type == "date" %}
                                            Tarih
                                        {% elif category.type == "number" %}
                                            Sayı
                                        {% elif category.type == "year" %}
                                            Yıl
                                        {% elif category.type == "file" %}
                                            Dosya
                                        {% endif %}
                                        </td>

                                        <td>
                                            <div class="btn-group">
                                                {% for p in perm %}
                                                    {% if p == 'change_businessBlogParametre' %}
                                                        <a href="{% url "ekabis:change_businessBlogParametre" business.uuid  category.uuid %}"
                                                           type="button" class="btn btn-warning"><i
                                                                class="fa fa-edit"></i>İncele
                                                        </a>
                                                    {% elif p == 'delete_businessBlogParametre' %}
                                                        <a class="btn btn-danger"
                                                           data-toggle="modal"
                                                           onclick=deleteParametre('{{ category.uuid }}')><i
                                                                class="fa fa-trash"></i>Sil</a>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </td>

                                    </tr>

                                {% endfor %}
                            {% endif %}


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </form>
</section>


<script>
    $(function () {
        {% if error_messages %}
            errors_messages({{ error_messages |safe }})
        {% endif %}


        $('#kullanicilar').DataTable({
            dom: 'Bfrtip',

            language: {
                buttons: {
                    pageLength: {
                        _: " %d  Tane Göster",
                        '-1': "Hepsini Göster"
                    }
                }
            },

            lengthMenu: [
                [10, 25, 50, 100, -1],
                ['10 tane', '25 tane ', '50 tane ', '100 Tane', 'Hepsini Getir']
            ],

            'buttons': [


                {
                    extend: "pageLength",
                },


                {
                    extend: 'colvis',
                    text: "Ekle Çıkar",
                    titleAttr: 'Ekle Çıkar'


                },
                {
                    extend: 'print',
                    title: 'Sporcular',
                    text: "Yazdır",

                    titleAttr: 'Yazdır'
                },
                {
                    extend: 'pdfHtml5',
                    download: 'open',
                    text: "Pdf",

                    titleAttr: 'Pdf Kaydet'
                },

                {
                    extend: 'excelHtml5',
                    text: "Excel",
                    titleAttr: 'Excel Kaydet'
                },
                {
                    text: 'Json',
                    action: function (e, dt, button, config) {
                        var data = dt.buttons.exportData();

                        $.fn.dataTable.fileSave(
                            new Blob([JSON.stringify(data)]),
                            'Sporcular.json'
                        );
                    }
                }


            ],
            'bubble': true,
            'paging': true,
            'lengthChange': true,
            'searching': true,
            'ordering': true,
            'info': true,
            'autoWidth': true,
            'responsive': true,
            'select': true,
        });

        $('#kategori').DataTable({
            dom: 'Bfrtip',

            language: {
                buttons: {
                    pageLength: {
                        _: " %d  Tane Göster",
                        '-1': "Hepsini Göster"
                    }
                }
            },

            lengthMenu: [
                [10, 25, 50, 100, -1],
                ['10 tane', '25 tane ', '50 tane ', '100 Tane', 'Hepsini Getir']
            ],

            'buttons': [


                {
                    extend: "pageLength",
                },


                {
                    extend: 'colvis',
                    text: "Ekle Çıkar",
                    titleAttr: 'Ekle Çıkar'


                },
                {
                    extend: 'print',
                    title: 'Sporcular',
                    text: "Yazdır",

                    titleAttr: 'Yazdır'
                },
                {
                    extend: 'pdfHtml5',
                    download: 'open',
                    text: "Pdf",

                    titleAttr: 'Pdf Kaydet'
                },

                {
                    extend: 'excelHtml5',
                    text: "Excel",
                    titleAttr: 'Excel Kaydet'
                },
                {
                    text: 'Json',
                    action: function (e, dt, button, config) {
                        var data = dt.buttons.exportData();

                        $.fn.dataTable.fileSave(
                            new Blob([JSON.stringify(data)]),
                            'Sporcular.json'
                        );
                    }
                }


            ],
            'bubble': true,
            'paging': true,
            'lengthChange': true,
            'searching': true,
            'ordering': true,
            'info': true,
            'autoWidth': true,
            'responsive': true,
            'select': true,
        });

    });

    function deleteParametre(id) {
        var html = ''
        $("#modal-danger").on("shown.bs.modal", function (e) {
            $("#btn-conf").click(function () {
                $.ajax({
                    url: "{% url "ekabis:delete_businessBlogParametre" %}",
                    type: "POST",
                    data: {
                        'csrfmiddlewaretoken': "{{  csrf_token  }}",
                        isActive: 'False',
                        uuid: id
                    },
                    success: function (result) {

                        html = 'Başarıyla Silindi';
                        debugger;
                        $(".successModal").html(html);
                        $('#modal-success').on("shown.bs.modal", function (e) {
                            $(".btn-ok").click(function () {

                                window.location.replace("{% url "ekabis:change_businessBlog" business.uuid %}");

                            });

                        }).modal('show');


                        console.log(result.status)
                    }
                });
            });
        }).modal('show');
        $('#btn-close').click(function () {
            $('#modal-danger').modal('hide');
        });

    }

</script>


{% endblock %}
